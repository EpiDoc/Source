<?xml version="1.0" encoding="UTF-8"?>
<crosswalk source="EDR" destination="KV">
    <input>
        <format>XML</format>
        <encoding>UTF-8</encoding>
    </input>
    <output>
        <format>XML</format>
    </output>


    <element name="inscriptiones">
        <for-each select="//epigr">
            <element name="inscriptio">

                <!-- filename  comes from the EDR id number (id_nr) -->
                <copy>
                    <destination>filename</destination>
                    <source>
                        <xpath>id_nr</xpath>
                    </source>
                </copy>

                <!-- "numerus" comes from the EDR id number (id_nr) -->
                <element name="numerus">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>id_nr</xpath>
                        </source>
                    </copy>
                </element>

                <!-- regio_ant = "regio antiqua" comes from the EDR schema field "provinz" -->
                <element name="regio_ant">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>provinz</xpath>
                        </source>
                    </copy>
                </element>

                <!-- regio_nos = "regio nostrae aetatis" comes from the EDR schema field "land" 
                        and a standard key and full name are added in processing -->
                <element name="regio_nos">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>land</xpath>
                        </source>
                    </copy>
                    <element name="reg">
                        <attribute name="key">
                            <source>
                                <xpath>land</xpath>
                            </source>
                            <substitutions type="vdex">
                                <sourceThesaurus>edrcountrycodes</sourceThesaurus>
                                <targetThesaurus>countrycodes</targetThesaurus>
                                <target>termIdentifier</target>
                            </substitutions>
                        </attribute>
                        <source>
                            <xpath>land</xpath>
                        </source>
                        <substitutions type="vdex">
                            <sourceThesaurus>edrcountrycodes</sourceThesaurus>
                            <targetThesaurus>countrycodes</targetThesaurus>
                            <target>caption</target>
                        </substitutions>
                    </element>
                </element>

                <!-- urbs_ant = "urbs antiqua" comes from the EDR schema field "fo_antik" -->
                <element name="urbs_ant">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>fo_antik</xpath>
                        </source>
                    </copy>
                </element>

                <!-- urbs_nos = "urbs nostrae aetatis" comes from the EDR schema field "fo_modern" -->
                <element name="urbs_nos">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>fo_modern</xpath>
                        </source>
                    </copy>
                </element>

                <!-- loc_inv = "locus inventionis" comes from the EDR schema field "fundstelle" -->
                <element name="loc_inv">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>fundstelle</xpath>
                        </source>
                    </copy>
                </element>

                <!-- loc_ads = "locus adservationis" comes from the EDR schmea field "aufbewahrung" -->
                <element name="loc_ads">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>aufbewahrung</xpath>
                        </source>
                    </copy>
                </element>

                <!-- rer_distrib = "rerum inscriptarum distributio" comes from the EDR schema field "denkmaltyp" -->
                <element name="rer_distrib">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>denkmaltyp</xpath>
                        </source>
                    </copy>
                    <element name="reg">
                        <attribute name="key">
                            <source>
                                <xpath>denkmaltyp</xpath>
                            </source>
                            <stringReplace>
                                <!-- values for this key are drawn directly from the Latin values used by EDR, substituting an underscore for the
                                    comma + space used in EDR. The actual values are being tranlated to multiple languages ahead of creating a 
                                    vdex file. -->
                                <find>, </find>
                                <replace>_</replace>
                            </stringReplace>
                        </attribute>
                        <source>
                            <xpath>denkmaltyp</xpath>
                        </source>
                    </element>
                </element>

                <!-- rei_mat = "rei materia" comes from the EDR schema field "material" -->
                <element name="rei_mat">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>material</xpath>
                        </source>
                    </copy>
                    <element name="reg">
                        <attribute name="key">
                            <!-- values for this key are drawn directly from the Latin values used by EDR. The actual 
                                values are being tranlated to multiple languages ahead of creating a vdex file. -->
                            <source>
                                <xpath>material</xpath>
                            </source>
                            <!--     don't need?                         <stringReplace>
                                <find xml:space="preserve"> </find>
                                <replace>_</replace>
                            </stringReplace> -->
                        </attribute>
                        <source>
                            <xpath>material</xpath>
                        </source>
                    </element>

                </element>

                <!-- "scriptura" comes from the EDR schema field "scriptura" -->
                <!-- coding here is incomplete; reg should contain a fully spelled out version of the Latin term, but at present we 
                    don't have these terms anywhere they're easy to get at. We will eventually produce a vdex file, and this should
                    be used for the reg lookup,  but first we need to get everything spelled out etc. and we're using the Goolge
                    Spreadsheets for that for now, q.v.. Meantime, we just use the abbreviated version, having suppressed full-stops
                    and substituted underscore for space -->
                <element name="scriptura">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>scriptura</xpath>
                        </source>
                    </copy>
                    <element name="reg">
                        <attribute name="key">
                            <source>
                                <xpath>scriptura</xpath>
                            </source>
                            <stringReplace>
                                <find xml:space="preserve"> </find>
                                <replace>_</replace>
                            </stringReplace>
                            <stringReplace>
                                <find>.</find>
                                <replace />
                            </stringReplace>
                        </attribute>
                        <source>
                            <xpath>scriptura</xpath>
                        </source>
                    </element>

                </element>

                <!-- "lingua" comes from the EDR schema field "scriptura" -->
                <element name="lingua">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>lingua</xpath>
                        </source>
                    </copy>
                    <element name="reg">
                        <attribute name="key">
                            <source>
                                <xpath>lingua</xpath>
                                <delimiter>-</delimiter>
                            </source>
                            <substitutions type="vdex">
                                <sourceThesaurus>edrlanguagecodes</sourceThesaurus>
                                <targetThesaurus>languagecodes</targetThesaurus>
                                <target>termIdentifier</target>
                            </substitutions>
                        </attribute>
                        <source>
                            <xpath>lingua</xpath>
                            <delimiter>-</delimiter>
                        </source>
                        <substitutions type="vdex">
                            <sourceThesaurus>edrlanguagecodes</sourceThesaurus>
                            <targetThesaurus>languagecodes</targetThesaurus>
                            <target>caption</target>
                        </substitutions>
                    </element>
                </element>

                <!-- tit_distrib = "Titulorum distributio" comes from the EDR schema field "i_gattung" -->
                <!-- same abbreviation problem and status as for "scriptura" above" -->
                <element name="tit_distrib">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>i_gattung</xpath>
                        </source>
                    </copy>
                    <element name="reg">
                        <attribute name="key">
                            <source>
                                <xpath>i_gattung</xpath>
                            </source>
                            <stringReplace>
                                <find xml:space="preserve"> </find>
                                <replace>_</replace>
                            </stringReplace>
                            <stringReplace>
                                <find>.</find>
                                <replace />
                            </stringReplace>
                        </attribute>
                        <source>
                            <xpath>i_gattung</xpath>
                        </source>
                    </element>
                </element>

                <!-- vir_distrib = "Virorum distributio" comes from the EDR schema field "livellosocialeTot" -->
                <!-- note: we are ignoring the two constituent fields in EDR from which this "tot" field is built on 
                    the grounds that its possible to manually edit the content of the "tot" field via the input form regardless
                    of the settings in the other two fields, which are not visible to the user. Therefore, the "tot" field
                    will contain the value that the EDR staff is used to seeing and that they expect -->
                <!-- same abbreviation problem and status as for "scriptura" above -->
                <element name="vir_distrib">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>livellosocialeTot</xpath>
                        </source>
                    </copy>
                    <!-- add reg and id; split for multiples if necessary -->
                </element>

                <!-- "editiones" comes from the EDR schema field "Bibliografia" -->
                <element name="editiones">
                    <!-- this needs code to split the field multiple times, and do wrapping  on the result -->
                </element>

                <!-- "textus" comes from the EDR schema field "Testo" -->
                <element name="textus">
                    <!-- this needs code to escape pointy brackets? -->
                    <source>
                        <xpath>Testo</xpath>
                    </source>
                </element>

                <!-- "apparatus" comes from the EDR schema field "Apparato" -->
                <element name="apparatus">
                    <source>
                        <xpath>Apparato</xpath>
                    </source>
                </element>

                <!-- "tempus" is a complicated combination of fields from the EDR schema -->
                <element name="tempus"> BBBAAAWWWAHAHAHAHAHA!!!!!! </element>

                <!-- "sched_script" = "schedae scriptor" comes from the EDR schema field "bearbeiter" -->
                <element name="sched_script">
                    <copy>
                        <destination>orig</destination>
                        <source>
                            <xpath>bearbeiter</xpath>
                        </source>
                    </copy>
                </element>

                <!-- "temp_sched" = "tempus schedae" comes from the EDR schema field "datum" -->
                <element name="temp_sched">
                    <copy>
                        <destination>temp_sched</destination>
                        <source>
                            <xpath>datum</xpath>
                        </source>
                        <!-- add code to strip out time -->
                    </copy>
                </element>


            </element>
        </for-each>
    </element>
</crosswalk>
