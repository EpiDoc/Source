<?xml version="1.0" encoding="UTF-8"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
   <map:components>
      <map:generators default="file">
         <map:generator name="request" src="org.apache.cocoon.generation.RequestGenerator">
            <map:parameter name="generate-attributes" value="true" />
         </map:generator>
      </map:generators>
      <map:transformers default="xslt">
         <map:transformer name="cinclude" src="org.apache.cocoon.transformation.CIncludeTransformer" />
      </map:transformers>
      <map:readers default="resource" />
      <map:serializers default="xhtmlbasic">
         <map:serializer mime-type="application/xhtml+xml" name="xhtmlbasic" src="org.apache.cocoon.serialization.XMLSerializer">
            <doctype-public>-//W3C//DTD XHTML 1.0 Strict//EN</doctype-public>
            <doctype-system>http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</doctype-system>
            <encoding>UTF-8</encoding>
            <indent>no</indent>
         </map:serializer>
         <map:serializer mime-type="text/xml" name="xml" src="org.apache.cocoon.serialization.XMLSerializer">
            <encoding>UTF-8</encoding>
            <indent>no</indent>
         </map:serializer>
         <map:serializer mime-type="text/xml" name="xmlepidoc" src="org.apache.cocoon.serialization.XMLSerializer">
            <doctype-system>tei-epidoc.dtd</doctype-system>
            <encoding>UTF-8</encoding>
            <indent>no</indent>
         </map:serializer>
      </map:serializers>
      <map:selectors default="browser" />
      <map:matchers default="wildcard" />
   </map:components>
   <map:pipelines>
      <map:pipeline>
         <!--
            ====================================================================================
            PRODUCTION MAPS
            ====================================================================================
            -->
         <!--
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            main home page (index.html)
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            -->
         <map:match pattern="">
            <map:generate src="src/index.xml" />
            <map:transform src="xsl/main.xsl" />
            <map:transform src="xsl/xhtmlindenter.xsl" />
            <map:serialize type="xhtmlbasic" />
         </map:match>
         <map:match pattern="index.html">
            <map:generate src="src/index.xml" />
            <map:transform src="xsl/main.xsl" />
            <map:transform src="xsl/xhtmlindenter.xsl" />
            <map:serialize type="xhtmlbasic" />
         </map:match>
         <!--
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            table of contents page (toc.html)
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            -->
         <!-- first map catches the browser request for the toc file -->
         <map:match pattern="toc.html">
            <map:generate src="src/topics/toc.xml" />
            <!-- get the toc.xml file from disk -->
            <map:transform type="cinclude" />
            <!-- process cincludes in the xml file; note that the only  
                                                                                                  cinclude there points at the second map below;
                                                                                                  this incorporates a filtered directory listing as a
                                                                                                  series of cincludes, one for each desireable file 
                                                                                                  in the directory -->
            <map:transform type="cinclude" />
            <!-- process cincludes inserted in the xml stream by the
                                                                                                 second map below -->
            <map:transform src="xsl/toc.xsl" />
            <!-- transform and massage the results for output -->
            <map:transform src="xsl/xhtmlindenter.xsl" />
            <map:serialize type="xhtmlbasic" />
         </map:match>
         <!-- second map reads the file list in the source (src) directory and uses an XSLT file to do some processing on it, 
                resulting in an xml stream of cincludes, one for each desireable file in the directory -->
         <map:match pattern="src/include">
            <map:generate src="src" type="directory" />
            <map:transform src="xsl/srcdirlist2cincludes.xsl">
               <map:parameter name="article-dir" value="src" />
            </map:transform>
            <map:serialize type="xml" />
         </map:match>
         <!--
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
         regular article pages (*.html) NB: this map needs to come after the more specific ones above
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
         -->
         <map:match pattern="*.html">
            <map:generate src="src/{1}.xml" />
            <map:transform src="../../xsl/epidoc-xsl-0.2/html/epidoc.xsl" />
            <map:transform src="../../xsl/util/xhtmlindenter.xsl" />
            <map:serialize type="xhtmlbasic" />
         </map:match>
         <map:match pattern="*.xml">
            <map:generate src="src/{1}.xml" />
            <map:transform src="../../xsl/util/teiindenter.xsl" />
            <map:serialize type="xmlepidoc" />
         </map:match>
         <!--
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
         other/auxiliary files 
         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
         -->
         <map:match pattern="*.css">
            <map:read mime-type="text/css" src="../../css/{1}.css" />
         </map:match>
         <map:match pattern="*.gif">
            <map:read mime-type="image/gif" src="../../img/{1}.gif" />
         </map:match>
         <map:match pattern="*.jpg">
            <map:read mime-type="image/jpeg" src="../../img/{1}.jpg" />
         </map:match>
         <map:match pattern="*.png">
            <map:read mime-type="image/png" src="../../img/{1}.png" />
         </map:match>
      </map:pipeline>
   </map:pipelines>
</map:sitemap>
